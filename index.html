<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Contactos - DOM y JavaScript</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>
<body>
    <div class="container my-1 my-sm-2 my-md-4 my-lg-5">
        <h1>Lista de Contactos</h1>
        <div class="card">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-12 col-md-6 mb-2">
                        <input id="input-buscar" class="form-control" placeholder="Buscar por nombre, apellido o teléfono">
                    </div>
                    <div class="col-12 col-md-6 d-flex gap-2">
                        <select id="select-orden" class="form-select w-auto">
                            <option value="nombre">Ordenar por Nombre</option>
                            <option value="apellido">Ordenar por Apellido</option>
                        </select>
                        <button id="btn-ordenar" class="btn btn-secondary">Ordenar</button>
                        <button id="btn-favoritos" class="btn btn-outline-primary">Mostrar Favoritos</button>
                        <button id="btn-eliminar-seleccionados" class="btn btn-danger" disabled>Eliminar seleccionados</button>
                    </div>
                </div>

                <ul id="lista-contactos" class="list-group mb-3"></ul>

                <hr class="hr">

                <h2>Nuevo Contacto</h2>
                <form id="form-producto">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" name="nombre" id="input-nombre" placeholder="Nombre" aria-label="Nombre">
                        <input type="text" class="form-control" name="apellido" id="input-apellido" placeholder="Apellido" aria-label="Apellido">
                        <input type="tel" class="form-control" name="telefono" id="input-telefono" placeholder="Teléfono" aria-label="Teléfono">
                    </div>
                    <button class="btn btn-primary" type="submit">Agregar Contacto</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script type="text/javascript">
        // estado y elementos
        const listaEl = document.getElementById('lista-contactos');
        const form = document.getElementById('form-producto');
        const inputNombre = document.getElementById('input-nombre');
        const inputApellido = document.getElementById('input-apellido');
        const inputTelefono = document.getElementById('input-telefono');
        const inputBuscar = document.getElementById('input-buscar');
        const selectOrden = document.getElementById('select-orden');
        const btnOrdenar = document.getElementById('btn-ordenar');
        const btnFavoritos = document.getElementById('btn-favoritos');
        const btnEliminarSeleccionados = document.getElementById('btn-eliminar-seleccionados');

        let contactos = [];
        let mostrarSoloFavoritos = false;
        let searchQuery = '';

        function save() {
            localStorage.setItem('contactos', JSON.stringify(contactos));
        }
        function load() {
            const raw = localStorage.getItem('contactos');
            if (raw) {
                try { contactos = JSON.parse(raw); } catch(e) { contactos = []; }
            } else {
                contactos = [{ id: 'c-' + Date.now(), nombre: 'Juan', apellido: 'Perez', telefono: '', favorito: false, seleccionado: false }];
            }
        }

        function agregarContacto(nombre, apellido, telefono) {
            const n = (nombre || '').trim();
            const a = (apellido || '').trim();
            const t = (telefono || '').trim();
            if (!n && !a) return;
            const contacto = { id: 'c-' + (Date.now() + Math.random()).toString(36), nombre: n, apellido: a, telefono: t, favorito: false, seleccionado: false };
            contactos.push(contacto);
            save();
            mostrarListado();
        }

        function toggleFavorito(id) {
            const c = contactos.find(p => p.id === id);
            if (!c) return;
            c.favorito = !c.favorito;
            save();
            mostrarListado();
        }

        function eliminarContacto(id) {
            contactos = contactos.filter(p => p.id !== id);
            save();
            mostrarListado();
        }

        function toggleSeleccion(id, value) {
            const c = contactos.find(p => p.id === id);
            if (!c) return;
            c.seleccionado = value;
            btnEliminarSeleccionados.disabled = !contactos.some(p => p.seleccionado);
        }

        function eliminarSeleccionados() {
            if (!confirm('Eliminar contactos seleccionados?')) return;
            contactos = contactos.filter(p => !p.seleccionado);
            save();
            mostrarListado();
        }

        function editarContacto(id) {
            const index = contactos.findIndex(p => p.id === id);
            if (index === -1) return;
            // renderizar formulario de edición inline (handled in mostrarListado)
        }

        function guardarEdicion(id, nombre, apellido, telefono) {
            const c = contactos.find(p => p.id === id);
            if (!c) return;
            c.nombre = (nombre || '').trim();
            c.apellido = (apellido || '').trim();
            c.telefono = (telefono || '').trim();
            save();
            mostrarListado();
        }

        function ordenarContactos(by) {
            contactos.sort((a,b) => (a[by] || '').toLowerCase().localeCompare((b[by] || '').toLowerCase()));
            save();
            mostrarListado();
        }

        function mostrarListado() {
            listaEl.innerHTML = '';
            const filtered = contactos.filter(c => {
                if (mostrarSoloFavoritos && !c.favorito) return false;
                if (!searchQuery) return true;
                const q = searchQuery.toLowerCase();
                return (c.nombre || '').toLowerCase().includes(q) || (c.apellido || '').toLowerCase().includes(q) || (c.telefono || '').toLowerCase().includes(q);
            });

            filtered.forEach(c => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';

                const left = document.createElement('div');
                left.className = 'd-flex align-items-center gap-2';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = !!c.seleccionado;
                checkbox.addEventListener('change', () => toggleSeleccion(c.id, checkbox.checked));

                const content = document.createElement('div');
                content.style.minWidth = '220px';

                const nameSpan = document.createElement('span');
                nameSpan.textContent = (c.nombre || '') + ' ' + (c.apellido || '');
                const phoneSpan = document.createElement('small');
                phoneSpan.className = 'text-muted ms-2';
                phoneSpan.textContent = c.telefono || '';

                if (c.favorito) {
                    nameSpan.style.fontWeight = '700';
                }

                content.appendChild(nameSpan);
                content.appendChild(phoneSpan);

                left.appendChild(checkbox);
                left.appendChild(content);

                const btnFav = document.createElement('button');
                btnFav.className = 'btn btn-sm btn-outline-warning me-1';
                btnFav.textContent = c.favorito ? '★' : '☆';
                btnFav.title = 'Marcar como favorito';
                btnFav.addEventListener('click', () => toggleFavorito(c.id));

                const btnEdit = document.createElement('button');
                btnEdit.className = 'btn btn-sm btn-outline-secondary me-1';
                btnEdit.textContent = 'Editar';
                btnEdit.addEventListener('click', () => {
                    // crear inputs inline
                    const inputN = document.createElement('input');
                    inputN.type = 'text';
                    inputN.value = c.nombre;
                    inputN.className = 'form-control form-control-sm me-1';
                    const inputA = document.createElement('input');
                    inputA.type = 'text';
                    inputA.value = c.apellido;
                    inputA.className = 'form-control form-control-sm me-1';
                    const inputT = document.createElement('input');
                    inputT.type = 'tel';
                    inputT.value = c.telefono;
                    inputT.className = 'form-control form-control-sm me-1';

                    const saveBtn = document.createElement('button');
                    saveBtn.className = 'btn btn-sm btn-success me-1';
                    saveBtn.textContent = 'Guardar';
                    saveBtn.addEventListener('click', () => {
                        guardarEdicion(c.id, inputN.value, inputA.value, inputT.value);
                    });

                    const cancelBtn = document.createElement('button');
                    cancelBtn.className = 'btn btn-sm btn-outline-secondary';
                    cancelBtn.textContent = 'Cancelar';
                    cancelBtn.addEventListener('click', () => mostrarListado());

                    content.innerHTML = '';
                    content.appendChild(inputN);
                    content.appendChild(inputA);
                    content.appendChild(inputT);
                    content.appendChild(saveBtn);
                    content.appendChild(cancelBtn);
                });

                const btnDelete = document.createElement('button');
                btnDelete.className = 'btn btn-sm btn-danger';
                btnDelete.textContent = 'Eliminar';
                btnDelete.addEventListener('click', () => {
                    if (confirm('Eliminar contacto?')) eliminarContacto(c.id);
                });

                const right = document.createElement('div');
                right.appendChild(btnFav);
                right.appendChild(btnEdit);
                right.appendChild(btnDelete);

                li.appendChild(left);
                li.appendChild(right);
                listaEl.appendChild(li);
            });

            // actualizar estado del boton eliminar seleccionados
            btnEliminarSeleccionados.disabled = !contactos.some(p => p.seleccionado);
        }

        // manejadores y enlaces
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            agregarContacto(inputNombre.value, inputApellido.value, inputTelefono.value);
            inputNombre.value = '';
            inputApellido.value = '';
            inputTelefono.value = '';
            inputNombre.focus();
        });

        btnOrdenar.addEventListener('click', function() {
            ordenarContactos(selectOrden.value);
        });

        btnFavoritos.addEventListener('click', function() {
            mostrarSoloFavoritos = !mostrarSoloFavoritos;
            btnFavoritos.classList.toggle('btn-primary', mostrarSoloFavoritos);
            btnFavoritos.classList.toggle('btn-outline-primary', !mostrarSoloFavoritos);
            mostrarListado();
        });

        btnEliminarSeleccionados.addEventListener('click', function() {
            eliminarSeleccionados();
        });

        inputBuscar.addEventListener('input', function() {
            searchQuery = this.value;
            mostrarListado();
        });

        // inicializar
        load();
        mostrarListado();
    </script>
</body>
</html>
