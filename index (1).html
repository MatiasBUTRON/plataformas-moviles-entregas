<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Compras - DOM y JavaScript</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>
<body>
    <div class="container my-1 my-sm-2 my-md-4 my-lg-5">
        <h1>Lista de Compras</h1>
        <div class="card">
            <div class="card-body">
                <h2>Listado de Productos</h2>
                
                <ul id="lista-productos" class="list-group mb-3">
                </ul>

                <hr class="hr">

                <h2>Agregar Producto</h2>
                <form id="form-producto">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" aria-label="Nombre del Producto">
                        <button class="btn btn-primary" type="submit">Agregar Producto</button>
                    </div>
                </form>

                <div class="d-flex gap-2">
                    <button id="btn-ordenar" class="btn btn-secondary">Ordenar Alfabeticamente</button>
                    <button id="btn-limpiar" class="btn btn-danger">Limpiar Lista</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const listaEl = document.getElementById('lista-productos');
        const form = document.getElementById('form-producto');
        const textoInput = form.querySelector('input');
        const btnOrdenar = document.getElementById('btn-ordenar');
        const btnLimpiar = document.getElementById('btn-limpiar');

        let productos = [];

        function saveProductos() {
            localStorage.setItem('listaCompras', JSON.stringify(productos));
        }
        function loadProductos() {
            const data = localStorage.getItem('listaCompras');
            if (data) {
                try { productos = JSON.parse(data); } catch(e) { productos = []; }
            } else {
                productos = [{ name: 'Pan', bought: false }];
            }
        }

        function render() {
            listaEl.innerHTML = '';
            productos.forEach((p, idx) => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';

                const left = document.createElement('div');
                left.className = 'd-flex align-items-center gap-2';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = !!p.bought;
                checkbox.addEventListener('change', () => {
                    productos[idx].bought = checkbox.checked;
                    saveProductos();
                    render();
                });

                const span = document.createElement('span');
                span.textContent = p.name;
                if (p.bought) span.style.textDecoration = 'line-through';

                left.appendChild(checkbox);
                left.appendChild(span);

                const btnEdit = document.createElement('button');
                btnEdit.className = 'btn btn-sm btn-outline-secondary me-1';
                btnEdit.textContent = 'Editar';
                btnEdit.addEventListener('click', () => {
                    const inputEdit = document.createElement('input');
                    inputEdit.type = 'text';
                    inputEdit.className = 'form-control form-control-sm';
                    inputEdit.value = p.name;
                    left.replaceChild(inputEdit, span);
                    inputEdit.focus();
                    function saveEdit() {
                        const val = inputEdit.value.trim();
                        if (val) productos[idx].name = val;
                        saveProductos();
                        render();
                    }
                    inputEdit.addEventListener('blur', saveEdit);
                    inputEdit.addEventListener('keyup', (e) => {
                        if (e.key === 'Enter') inputEdit.blur();
                        if (e.key === 'Escape') render();
                    });
                });

                const btnDelete = document.createElement('button');
                btnDelete.className = 'btn btn-sm btn-danger';
                btnDelete.textContent = 'Eliminar';
                btnDelete.addEventListener('click', () => {
                    productos.splice(idx, 1);
                    saveProductos();
                    render();
                });

                const right = document.createElement('div');
                right.appendChild(btnEdit);
                right.appendChild(btnDelete);

                li.appendChild(left);
                li.appendChild(right);

                listaEl.appendChild(li);
            });
        }

        function agregarProducto(nombreProducto) {
            const n = (nombreProducto || '').trim();
            if (!n) return;
            productos.push({ name: n, bought: false });
            saveProductos();
            render();
        }

        function handlerFormulario(evento) {
            evento.preventDefault();
            const nombreProducto = textoInput.value;
            textoInput.value = '';
            agregarProducto(nombreProducto);
            textoInput.focus();
        }

        form.addEventListener('submit', handlerFormulario);
        btnOrdenar.addEventListener('click', () => {
            productos.sort((a,b) => a.name.localeCompare(b.name));
            saveProductos();
            render();
        });
        btnLimpiar.addEventListener('click', () => {
            if (confirm('Â¿Borrar todos los productos?')) {
                productos = [];
                saveProductos();
                render();
            }
        });

        // inicializar
        loadProductos();
        render();
    </script>
</body>
</html>
